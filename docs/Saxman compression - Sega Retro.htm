<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Saxman compression - Sega Retro</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Saxman_compression","wgTitle":"Saxman compression","wgCurRevisionId":772196,"wgRevisionId":772196,"wgArticleId":60437,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Data compression"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Saxman_compression","wgRelevantArticleId":60437,"wgRequestId":"0acd71ef41a67221e3a59c03","wgCSPNonce":false,"wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgCargoMapClusteringMinimum":80,"wgCargoMonthNames":["January","February","March","April","May","June","July","August","September","October","November","December"],"wgCargoMonthNamesShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgCargoWeekDays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"wgCargoWeekDaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.toc.styles":"ready","skins.foreground.styles":"ready"});mw.loader.implement("user.tokens@0tffind",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});RLPAGEMODULES=["site","mediawiki.page.startup","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.foreground.js"];mw.loader.load(RLPAGEMODULES);});</script>
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.toc.styles%7Cskins.foreground.styles&amp;only=styles&amp;skin=foreground"/>
<script async="" src="/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;skin=foreground"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=foreground"/>
<meta name="generator" content="MediaWiki 1.33.4"/>
<meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0"/>
<meta name="theme-color" content="#41a0f0"/>
<link rel="shortcut icon" href="/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Sega Retro (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://segaretro.org/api.php?action=rsd"/>
<link rel="license" href="https://www.gnu.org/licenses/old-licenses/fdl-1.2.txt" />
<link rel="alternate" type="application/atom+xml" title="Sega Retro Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<meta property="og:title" content="Saxman compression - Sega Retro"/>
<meta property="og:site_name" content="Sega Retro"/>
<meta property="og:url" content="https://segaretro.org/Saxman_compression"/>
<meta property="og:image" content="https://segaretro.org/skins/foreground/assets/img/segaretro_logo.png"/>
<meta property="article:modified_time" content="2022-04-27T18:22:10Z"/>
<meta property="article:published_time" content="2022-04-27T18:22:10Z"/>
<meta property="twitter:site" content="@segaretro"/>
<meta property="twitter:title" content="Saxman compression - Sega Retro"/>
<meta property="twitter:image" content="https://segaretro.org/skins/foreground/assets/img/segaretro_logo.png"/>
<meta property="twitter:card" content="summary"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","type":"article","name":"Saxman compression - Sega Retro","headline":"Saxman compression - Sega Retro","mainEntityOfPage":"Saxman compression","identifier":"https:\/\/segaretro.org\/Saxman_compression","url":"https:\/\/segaretro.org\/Saxman_compression","dateModified":"2022-04-27T18:22:10Z","datePublished":"2022-04-27T18:22:10Z","image":null,"author":{"@type":"Organization","name":"Sega Retro","url":"https:\/\/segaretro.org","logo":{"@type":"ImageObject","url":"https:\/\/segaretro.org\/skins\/foreground\/assets\/img\/segaretro_logo.png","caption":"Sega Retro"}},"publisher":{"@type":"Organization","name":"Sega Retro","url":"https:\/\/segaretro.org","logo":{"@type":"ImageObject","url":"https:\/\/segaretro.org\/skins\/foreground\/assets\/img\/segaretro_logo.png","caption":"Sega Retro"}},"potentialAction":{"@type":"SearchAction","target":"https:\/\/segaretro.org\/index.php?title=Special:Search&search={search_term}","query-input":"required name=search_term"}}</script>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="theme-color" content="#41a0f0" />
<link rel="icon" sizes="192x192" href="https://segaretro.org/favicon.svg">
<link rel="icon" sizes="128x128" href="https://segaretro.org/favicon.svg">
<link rel="preload" href="/skins/foreground/assets/stylesheets/font-awesome.css" as="style">
<link rel="preload" href="/skins/foreground/assets/fonts/fontawesome-webfont.woff2" as="font">
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://www.googletagmanager.com">
<!--[if lt IE 9]><script src="/load.php?lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Foreground&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Saxman_compression rootpage-Saxman_compression skin-foreground action-view"><div id='navwrapper'><!-- START FOREGROUNDTEMPLATE -->
<a class="skip-main" href="#content">Skip to main content</a>
		<nav class="top-bar" data-topbar role="navigation" data-options="back_text: Back">
			<ul class="title-area">
				<li class="name">
					<div class="title-name">
					<a href="/Main_Page">
											<img alt="Sega Retro" height="30" width="136" class="top-bar-logo" src="/skins/foreground/assets/img/segaretro_logo.png">
										
					</a>
					</div>
				</li>
				<li class="toggle-topbar menu-icon">
					<a href="#"><span>Menu</span></a>
				</li>
			</ul>

		<section class="top-bar-section">

			<ul id="top-bar-left" role="menubar" class="left">
				<li class="divider show-for-small" role="presentation"></li>
									<li class="has-dropdown active" role="menuitem"  id='p-Main_Navigation'>
					<a href="#">Main Navigation</a>
													<ul class="dropdown" role="menu">
								<li id="n-mainpage"><a href="/Main_Page" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-recentchanges"><a href="/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="/Help:Contents" title="The place to find out">Help</a></li><li id="n-specialpages"><a href="/Special:SpecialPages">Special pages</a></li><li id="n-Upload"><a href="/Special:Upload">Upload file</a></li>							</ul>
																		<li class="has-dropdown active" role="menuitem"  id='p-Home_Consoles'>
					<a href="#">Home Consoles</a>
													<ul class="dropdown" role="menu">
								<li id="n-SG-1000"><a href="/Category:SG-1000">SG-1000</a></li><li id="n-Sega-Master-System"><a href="/Category:Sega_Master_System">Sega Master System</a></li><li id="n-Sega-Mega-Drive"><a href="/Category:Sega_Mega_Drive">Sega Mega Drive</a></li><li id="n-Sega-Game-Gear"><a href="/Category:Sega_Game_Gear">Sega Game Gear</a></li><li id="n-Sega-Mega-CD"><a href="/Category:Sega_Mega-CD">Sega Mega-CD</a></li><li id="n-Sega-32X"><a href="/Category:Sega_32X">Sega 32X</a></li><li id="n-Sega-Pico"><a href="/Category:Sega_Pico">Sega Pico</a></li><li id="n-Sega-Saturn"><a href="/Category:Sega_Saturn">Sega Saturn</a></li><li id="n-Sega-Dreamcast"><a href="/Category:Sega_Dreamcast">Sega Dreamcast</a></li><li id="n-Advanced-Pico-Beena"><a href="/Category:Advanced_Pico_Beena">Advanced Pico Beena</a></li><li id="n-Non-Sega-consoles"><a href="/Category:Non-Sega_consoles">Non-Sega consoles</a></li>							</ul>
																		<li class="has-dropdown active" role="menuitem"  id='p-Arcade_Systems'>
					<a href="#">Arcade Systems</a>
													<ul class="dropdown" role="menu">
								<li id="n-Electro-mechanical"><a href="/Category:Electro-mechanical_arcade_games">Electro-mechanical</a></li><li id="n-Pre-System-1"><a href="/Category:Pre-System_1_arcade_systems">Pre-System 1</a></li><li id="n-Sega-System-series"><a href="/Category:Sega_System_series">Sega System series</a></li><li id="n-Sega-Model-series"><a href="/Category:Sega_Model_series">Sega Model series</a></li><li id="n-Sega-NAOMI-series"><a href="/Category:Sega_NAOMI">Sega NAOMI series</a></li><li id="n-Post-NAOMI"><a href="/Category:Post-NAOMI_arcade_systems">Post-NAOMI</a></li><li id="n-Pinball-Tables"><a href="/Category:Pinball">Pinball Tables</a></li><li id="n-Slots.2C-redemptions.2C-etc."><a href="/Category:Miscellaneous_arcade_systems">Slots, redemptions, etc.</a></li>							</ul>
																		<li class="has-dropdown active" role="menuitem"  id='p-Sega'>
					<a href="#">Sega</a>
													<ul class="dropdown" role="menu">
								<li id="n-Sega"><a href="/Category:Sega">Sega</a></li><li id="n-People"><a href="/Category:People">People</a></li><li id="n-Franchises"><a href="/Category:Franchises">Franchises</a></li><li id="n-Consumer-products"><a href="/Category:Consumer_products">Consumer products</a></li><li id="n-Venues"><a href="/Category:Venues">Venues</a></li>							</ul>
																		<li class="has-dropdown active" role="menuitem"  id='p-Development'>
					<a href="#">Development</a>
													<ul class="dropdown" role="menu">
								<li id="n-Emulation"><a href="/Category:Emulation">Emulation</a></li><li id="n-Programs"><a href="/Category:Programs">Programs</a></li><li id="n-Official-documentation"><a href="/Category:Official_documentation">Official documentation</a></li><li id="n-Unofficial-documentation"><a href="/Category:Unofficial_documentation">Unofficial documentation</a></li>							</ul>
																							</ul>

			<ul id="top-bar-right" role="menubar" class="right">
				<li class="has-form" role="presentation">
					<form action="/index.php" id="searchform" aria-labelledby="searchbutton" role="search" class="mw-search">
						<div class="row collapse">
						<div class="small-12 columns">
							<input type="search" name="search" placeholder="Search Sega Retro" title="Search Sega Retro [f]" accesskey="f" id="searchInput"/>							<button type="submit" id="searchbutton" class="button search">Search</button>
						</div>
						</div>
					</form>
				</li>
				<li class="divider show-for-small" aria-hidden="true"></li>

				<li class="has-dropdown active" role="menuitem"><a href="#" aria-label="Page Interaction Menu"><i aria-hidden="true" title="Cogs Icon" class="fa fa-cogs"></i></a>
					<ul id="toolbox-dropdown" class="dropdown" role="menu">
						<li id="t-whatlinkshere"><a href="/Special:WhatLinksHere/Saxman_compression" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="/Special:RecentChangesLinked/Saxman_compression" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="/index.php?title=Saxman_compression&amp;rdfrom=https%3A%2F%2Finfo.sonicretro.org%2Findex.php%3Ftitle%3DSaxman_compression%26redirect%3Dno&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="/index.php?title=Saxman_compression&amp;oldid=772196" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="/index.php?title=Saxman_compression&amp;action=info" title="More information about this page">Page information</a></li><li id="t-cite"><a href="/index.php?title=Special:CiteThisPage&amp;page=Saxman_compression&amp;id=772196" title="Information on how to cite this page">Cite this page</a></li><li id="t-cargopagevalueslink"><a href="/index.php?title=Saxman_compression&amp;action=pagevalues" rel="cargo-pagevalues">Page values</a></li>																	</ul>
				</li>

				<li id="personal-tools-dropdown" role="menuitem" class="has-dropdown active"><a href="#" aria-label="User Menu"><i aria-hidden="true" title="User Icon" class="fa fa-user"></i></a>
					<ul class="dropdown" role="menu">
						<li id="pt-createaccount"><a href="/index.php?title=Special:CreateAccount&amp;returnto=Saxman+compression&amp;returntoquery=rdfrom%3Dhttps%253A%252F%252Finfo.sonicretro.org%252Findex.php%253Ftitle%253DSaxman_compression%2526redirect%253Dno" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li><li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=Saxman+compression&amp;returntoquery=rdfrom%3Dhttps%253A%252F%252Finfo.sonicretro.org%252Findex.php%253Ftitle%253DSaxman_compression%2526redirect%253Dno" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>					</ul>
				</li>

			</ul>
		</section>
		</nav>
		
		</div>		
		<div id="page-content">
		<div class="row fullWidth">
				<div class="large-12 columns">
					<!-- Output page indicators -->
					<div class="mw-indicators mw-body-content">
</div>
					<!-- If user is logged in output echo location -->
									<!--[if lt IE 9]>
				<div id="siteNotice" class="sitenotice panel radius">Sega Retro may not look as expected in this version of Internet Explorer. We recommend you upgrade to a newer version of Internet Explorer or switch to a browser like Firefox or Chrome.</div>
				<![endif]-->

												</div>
		</div>

		<div id="mw-js-message" style="display:none;"></div>

		<div style="width:85%; margin-left:8%;  margin-right:8%;">
				<div id="p-cactions" class="large-12 columns">
											<a id="actions-button" href="#" data-dropdown="actions" role="complementary" aria-label="Actions Menu" data-options="align:left; is_hover: true; hover_timeout:700" class="button small secondary radius"><i class="fa fa-cog" aria-hidden="true" title="Cogs Icon"><span class="show-for-medium-up">&nbsp;Actions</span></i></a>
						<!--RTL -->
						<ul id="actions" class="f-dropdown" data-dropdown-content>
							<li id="ca-nstab-main" class="selected"><a href="/Saxman_compression" title="View the content page [c]" accesskey="c">Page</a></li><li id="ca-talk" class="new"><a href="/index.php?title=Talk:Saxman_compression&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></li><li id="ca-viewsource"><a href="/index.php?title=Saxman_compression&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li><li id="ca-history"><a href="/index.php?title=Saxman_compression&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>													</ul>
						<!--RTL -->
										<div id="content" role="main">
					<h1  id="firstHeading" class="title">Saxman compression</h1>
											<h2 id="tagline">From Sega Retro</h2>					<div id="contentSub" class="clear_both"></div>
					<div id="bodyContent" class="mw-bodytext">
						<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p><b>Saxman compression</b> is the name given to the compression format used in the game <i><a href="/Sonic_the_Hedgehog_2_(Mega_Drive)" title="Sonic the Hedgehog 2 (Mega Drive)">Sonic the Hedgehog 2</a></i> for the <a href="/Sega_Genesis" class="mw-redirect" title="Sega Genesis">Sega Genesis/Mega Drive</a>. Its name was given in honor of the person who cracked the format, <a href="https://info.sonicretro.org/User:Saxman" class="extiw" title="sonic:User:Saxman">saxman</a>. It is a variation of the <a href="/LZSS" title="LZSS">LZSS</a> algorithm.
</p><p><br />
The two uses of Saxman compression in <i><a href="/Sonic_the_Hedgehog_2_(Mega_Drive)" title="Sonic the Hedgehog 2 (Mega Drive)">Sonic the Hedgehog 2</a></i> are:
</p>
<ul><li>It is used to compress music data. In this case, the compressed data is prefixed with a small 2-byte header, listing the size of the compressed data in little-endian format.</li>
<li>It is used to compress the <a href="/SMPS" title="SMPS">SMPS</a> sound driver. In this case, the compressed data is not prefixed with a header - rather, the data's size is baked-into the decompressor's code.</li></ul>
<div id="toc" class="toc"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Compression_Theory"><span class="tocnumber">1</span> <span class="toctext">Compression Theory</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Basic_Format"><span class="tocnumber">1.1</span> <span class="toctext">Basic Format</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Description_Field"><span class="tocnumber">1.2</span> <span class="toctext">Description Field</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Uncompressed_Data"><span class="tocnumber">1.3</span> <span class="toctext">Uncompressed Data</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Dictionary_Match.2FZero_Fill"><span class="tocnumber">1.4</span> <span class="toctext">Dictionary Match/Zero Fill</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Examples"><span class="tocnumber">1.5</span> <span class="toctext">Examples</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#Zero_Fill"><span class="tocnumber">1.5.1</span> <span class="toctext">Zero Fill</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Origin"><span class="tocnumber">2</span> <span class="toctext">Origin</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Decompression_code"><span class="tocnumber">3</span> <span class="toctext">Decompression code</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Compression_Theory">Compression Theory</span></h2>
<h3><span class="mw-headline" id="Basic_Format">Basic Format</span></h3>
<p>The Saxman compression scheme is a basic implementation of LZSS, but with the quirk that dictionary matches can reference bytes beyond the start of the decompressed data. Such a match is called a 'zero fill', as the bytes it produces are all 00.
</p><p>The compressed data follows the following format:
</p>
<pre>AA BB BB .. AA BB BB ..
</pre>
<p>The A field is referred to as the description field. This is always 1 byte in length, starting at the beginning of the compressed data, and is followed by the B field, which is referred to as the data field. This goes on for as long as is necessary to cover all the data described in the description field. After that, the pattern repeats until the end of the compressed data is reached.
</p>
<h3><span class="mw-headline" id="Description_Field">Description Field</span></h3>
<p>The description field is made up of 8 bits in little endian bit (not byte) order, which means that the least significant bit is read first; in other words, each byte is read "backwards." So for example, if the description field is:
</p>
<pre>FE</pre>
<p>then the description field, in bits, in the correct order for interpretation, will be:
</p>
<pre>[0111 1111]</pre>
<p>Now, going from left to right, each bit is interpreted in the following way:
</p>
<ul><li>If the bit is a 1, it indicates uncompressed data.</li>
<li>If the bit is a 0, it indicates either a dictionary match or a zero fill.</li></ul>
<p>When the last bit from a description field is read, the corresponding command is processed normally. After it has finished being processed, if the file has not ended yet, then a new descriptor field will be read from the file. If the end of file is reached (as counted by number of bytes already read, compared to the size of compression data) and there are still description field bits left, they are ignored.
</p>
<h3><span class="mw-headline" id="Uncompressed_Data">Uncompressed Data</span></h3>
<p>If a 1 is read in the description field, the corresponding byte in the data field is already uncompressed and simply copied to the destination as-is.
</p>
<h3><span id="Dictionary_Match/Zero_Fill"></span><span class="mw-headline" id="Dictionary_Match.2FZero_Fill">Dictionary Match/Zero Fill</span></h3>
<p>Dictionary matches and zero fills are both indicated by a 0 in the description field. The next 2 bytes will then form the offset and length: the format of these bytes is:
</p>
<pre>[LLLL LLLL] [HHHH CCCC]
</pre>
<p>The CCCC bits, plus 3, is the number of bytes to be copied (for dictionary matches) or the number of zeros to write (for zero fills). The remaining bits are used to form the position to copy from.  Unlike what happens in <i>normal</i> LZSS or in <b><a href="/Kosinski_compression" title="Kosinski compression">Kosinski</a></b>, the offset is not completely relative in Saxman compression; instead, the position to copy from is computed based on the following pseudo-code:
</p>
<pre>base = ((%HHHHLLLLLLLL + $12) &amp; $FFF)                           ; Combine everything into an address
source = ((base - destination) &amp; $FFF) + destination - $1000    ; Rebase it around destination
</pre>
<p>where "destination" is the relative address where data will be copied to (based on the start of the decoding buffer), and "source" is where data will be copied from in a dictionary match. The "base" address is an absolute address within the $1000-byte block obtained by stripping all but the high 4 bits of "destination"; it has to be <i>rebased</i> around "destination" as shown above to preserve the $1000-byte sliding window of the format. Whenever the resulting "source" address computed above is greater than the "destination" address in an unsigned comparison then, instead of copying bytes from the given location, the decoder will perform a zero fill instead. This can only happen due to integer overflow if "destination" is less than $1000 bytes and "base" ends up being more than "destination".
</p><p>Note: the Saxman/z80 decoder has only $800 bytes in its decompression buffer, so it does not rebase the address (nor does it need to); this means, however, that the decoder is simply unable to handle files that are longer than $1000 bytes when decompressed even if you give it a large enough decompression buffer to work with. In contrast, the Saxman/68k decoder does rebase it — but while the rebasing process is functionally equivalent to the pseudo-code given above, it is done in a different form which obscures what is happening.
</p>
<h3><span class="mw-headline" id="Examples">Examples</span></h3>
<h4><span class="mw-headline" id="Zero_Fill">Zero Fill</span></h4>
<p>The following Saxman/z80-compressed stream:
</p>
<pre>03 00 00 00 FF</pre>
<p>produces the following output:
</p>
<pre>00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</pre>
<p>The first two bytes are the compressed data length, in Big endian order: that is, the compressed data is 3 bytes. The next byte is a description field: [0000 0000]. Reading the lowest bit first, we get a zero, indicating either a dictionary match or a zero fill; the next two bytes are the source address and length, and come out to a source position of $0F12 (computed as outlined above) and a length of $12. These flag a zero fill, since the source ($0F12) is after the destination ($0000), so we write $12 zeroes. When reading a new bit, we notice that all 3 bytes in the compressed data have been read, so decompression terminates.
</p>
<h2><span class="mw-headline" id="Origin">Origin</span></h2>
<p>Saxman is derived from <a rel="nofollow" class="external text" href="https://web.archive.org/web/19990203141013/http://oak.oakland.edu/pub/simtelnet/msdos/arcutils/lz_comp2.zip">an LZSS implementation by Haruhiko Okumura</a>, which dates back to the late 1980s. The two decompressors used by <i><a href="/Sonic_the_Hedgehog_2_(Mega_Drive)" title="Sonic the Hedgehog 2 (Mega Drive)">Sonic the Hedgehog 2</a></i> are largely transcriptions of the original C code.
</p><p>Saxman bears one difference from Okumura's format: dictionary matches that point to before the start of the decompressed data produce 0x00 bytes, instead of the 0x20 bytes of the original.
</p><p><br />
In order to convert Okumura's compressor/decompressor to support Saxman, both uses of the space ASCII character in LZSS.C must be changed to zero instead. To be more specific, these two lines...
</p><p><br />
</p>
<pre>	for (i = s; i &lt; r; i++) text_buf[i] = ' ';  /* Clear the buffer with
		any character that will appear often. */</pre>
<p><br />
</p>
<pre>	for (i = 0; i &lt; N - F; i++) text_buf[i] = ' ';</pre>
<p><br />
...must be changed to this:
</p><p><br />
</p>
<pre>	for (i = s; i &lt; r; i++) text_buf[i] = 0;  /* Clear the buffer with
		any character that will appear often. */</pre>
<p><br />
</p>
<pre>	for (i = 0; i &lt; N - F; i++) text_buf[i] = 0;</pre>
<h2><span class="mw-headline" id="Decompression_code">Decompression code</span></h2>
<p>An annotated version of the Saxman/z80 decompression code is provided below for reference. The code is taken from the <i><a href="/Sonic_the_Hedgehog_2_(Mega_Drive)" title="Sonic the Hedgehog 2 (Mega Drive)">Sonic the Hedgehog 2</a></i> sound driver.
</p>
<pre>;zsub_1271
zSaxmanDec:
	exx
	ld	bc,0
	ld	de,0
	exx
	ld	de,zMusicData
	ld	c,(hl)
	inc	hl
	ld	b,(hl)					; bc = (hl) i.e. "size of song"
	inc	hl
	ld	(zGetNextByte+1),hl		; modify inst. @ zGetNextByte -- set to beginning of decompression stream
	inc	bc
	ld	(zDecEndOrGetByte+1),bc&#160;; modify inst. @ zDecEndOrGetByte -- set to length of song, +1

;zloc_1288
zSaxmanReadLoop:
	
	exx							; shadow reg set
	srl	c						; c >> 1 (active control byte)
	srl	b						; b >> 1 (just a mask that lets us know when we need to reload)
	bit	0,b						; test next bit of 'b'
	jr	nz,+					; if it's set, we still have bits left in 'c'; jump to '+'
	; If you get here, we're out of bits in 'c'!
	call	zDecEndOrGetByte	; get next byte -> 'a'
	ld	c,a						; a -> 'c'
	ld	b,0FFh					; b = FFh (8 new bits in 'c')
+
	bit	0,c						; test next bit of 'c'
	exx							; normal reg set
	jr	z,+						; if bit not set, it's a compression bit; jump to '+'
	; If you get here, there's a non-compressed byte
	call	zDecEndOrGetByte	; get next byte -> 'a'	
	ld	(de),a					; store it directly to the target memory address
	inc	de						; de++
	exx							; shadow reg set
	inc	de						; Also increase shadow-side 'de'... relative pointer only, does not point to output Z80_RAM
	exx							; normal reg set
	jr	zSaxmanReadLoop			; loop back around...
+
	call	zDecEndOrGetByte	; get next byte -> 'a'
	ld	c,a						; a -> 'c' (low byte of target address)
	call	zDecEndOrGetByte	; get next byte -> 'a'
	ld	b,a						; a -> 'b' (high byte of target address + count)
	and	0Fh						; keep only lower four bits...
	add	a,3						; add 3 (minimum 3 bytes are to be read in this mode)
	push	af					; save 'a'...
	ld	a,b						; b -> 'a' (low byte of target address)
	rlca
	rlca
	rlca
	rlca
	and	0Fh						; basically (b >> 4) &amp; 0xF (upper four bits now exclusively as lower four bits)
	ld	b,a						; a -> 'b' (only upper four bits of value make up part of the address)
	ld	a,c	
	add	a,12h
	ld	c,a
	adc	a,b
	sub	c
	and	0Fh
	ld	b,a						; bc += 12h
	pop	af						; restore 'a' (byte count to read; no less than 3)
	exx							; shadow reg set
	push	de					; keep current 'de' (relative pointer) value...
	ld	l,a						; how many bytes we will read -> 'hl'
	ld	h,0
	add	hl,de					; add current relative pointer...
	ex	de,hl					; effectively, de += a
	exx							; normal reg set
	pop	hl						; shadow 'de' -> 'hl' (relative pointer, prior to all bytes read, relative)
	or	a						; Clear carry
	sbc	hl,bc					; hl -= bc
	jr	nc,+					; if result positive, jump to '+'
	ex	de,hl					; current output pointer -> 'hl'
	ld	b,a						; how many bytes to load -> 'b'

-	ld	(hl),0					; fill in zeroes that many times
	inc	hl
	djnz	-

	ex	de,hl					; output pointer updated
	jr	zSaxmanReadLoop			; loop back around...
+
	ld	hl,zMusicData			; point at beginning of decompression point
	add	hl,bc					; move ahead however many bytes
	ld	c,a
	ld	b,0
	ldir
	jr	zSaxmanReadLoop
; End of function zSaxmanDec


; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||


; This is an ugly countdown to zero implemented in repeatedly modifying code!!
; But basically, it starts at the full length of the song +1 (so it can decrement)
; and waits until 'hl' decrements to zero
;zsub_12E8
zDecEndOrGetByte:
	ld	hl,0					; "self-modified code" -- starts at full length of song +1, waits until it gets to 1...
	dec	hl						; ... where this will be zero
	ld	(zDecEndOrGetByte+1),hl	; "self-modifying code" -- update the count in case it's not zero
	ld	a,h	
	or	l
	jr	z,+						; If 'h' and 'l' both equal zero, we quit!!
;zloc_12F3
zGetNextByte:
	ld	hl,0				; "self-modified code" -- get address of next compressed byte
	ld	a,(hl)				; put it into -> 'a'
	inc	hl					; next byte...
	ld	(zGetNextByte+1),hl	; change inst @ zGetNextByte so it loads next compressed byte
	ret						; still going...
+
	pop	hl					; throws away return address to this function call so that next 'ret' exits decompressor (we're done!)
	ret						; Exit decompressor
; End of function zDecEndOrGetByte</pre>
<!-- 
NewPP limit report
Cached time: 20251127133427
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.009 seconds
Real time usage: 0.010 seconds
Preprocessor visited node count: 137/1000000
Preprocessor generated node count: 280/1000000
Post‐expand include size: 0/1024000000 bytes
Template argument size: 0/1024000000 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 4855/5000000 bytes
ExtLoops count: 0/5000
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key sonicret_sega:pcache:idhash:60437-0!canonical and timestamp 20251127133427 and revision id 772196
 -->
</div></div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://segaretro.org/index.php?title=Saxman_compression&amp;oldid=772196">https://segaretro.org/index.php?title=Saxman_compression&amp;oldid=772196</a>"</div>
						<div class="clear_both"></div>
					</div>
		    	<div class="group"><div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/Category:Data_compression" title="Category:Data compression">Data compression</a></li></ul></div></div></div>
		    					</div>
		    </div>
		</div>

</div></div>
</div>			<footer class="large-12 columns" style="margin-top: 20px; padding:0; background:#000;" role="contentinfo">
				<div id="footer" class="fullWidth">
<div class="expanded row">
					<div class="large-6 small-12 columns" id="footerLeft">
<p><!--<a href="#" style="display:inline-block; float:left; margin-right: 10px;"><img src="/skins/foreground/assets/img/bc_grey.png" style="height:32px" alt="Backwards Compatible logo"></a>-->
Sega Retro is part of the Backwards Compatible family of sites, which are dedicated to research and preservation of gaming history and culture.<br/><strong><a href="https://www.patreon.com/segaretro">Donate</a></strong> | <a href="https://retrocdn.net/Privacy_Policy">Privacy Policy</a> | <a href="#">About Sega Retro</a> | <a href="#">Contact</a></p></div>
                                        <div class="large-6 small-12 columns" id="footerRight">
<p>Except where otherwise noted, content on this site is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International license</a>.</p></div>
</div>
			</div>
			</footer>

		
		
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.009","walltime":"0.010","ppvisitednodes":{"value":137,"limit":1000000},"ppgeneratednodes":{"value":280,"limit":1000000},"postexpandincludesize":{"value":0,"limit":1024000000},"templateargumentsize":{"value":0,"limit":1024000000},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":4855,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"loops":{"limitreport-count-limited":{"value":0,"limit":5000}},"cachereport":{"timestamp":"20251127133427","ttl":86400,"transientcontent":false}}});mw.config.set({"wgBackendResponseTime":168});});</script>				
		</body>
		</html>

